@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Form.cshtml";
}

<script src="~/Content/js/jqgrid/jqgrid.min.js"></script>
<script src="~/Content/js/jqgrid/grid.locale-cn.js"></script>
<script>
    var keyValue = $.request("keyValue");
    var itemId = $.request("itemId");
    var parentId = $.request("parentId");
    var lastSel;
    $(function () {
        initControl();
        if (!!keyValue) {
            $.ajax({
                url: rootUrl + "/BaseManage/Material/GetFormJson",
                data: { keyValue: keyValue },
                dataType: "json",
                async: false,
                success: function (data) {
                    data['1_F_UomType'] = '1';
                    data['2_F_UomType'] = '0';
                    data['3_F_UomType'] = '0';
                    data['4_F_UomType'] = '0';
                    $("#form1").formSerialize(data);
                }
            });
        } else {
            var data = { F_ItemGroupID: "", F_ItemCategoryID: "" };
            if (parentId == "0") {
                data.F_ItemGroupID = itemId;
                data.F_ItemCategoryID = '';
            } else {
                data.F_ItemGroupID = parentId;
                data.F_ItemCategoryID = itemId;
            }
            data['1_F_UomType'] = '1';
            data['2_F_UomType'] = '0';
            data['3_F_UomType'] = '0';
            data['4_F_UomType'] = '0';
            $("#form1").formSerialize(data);
        }
    });


    function initControl() {
        $("#F_ItemGroupID").bindSelect({
            url: rootUrl + "/BaseManage/MaterialGroup/GetSelectJson",
            param: { keyValue: "0" },
            id: "F_Id",
            text: "F_FullName"
        });

        $("#F_ItemCategoryID").bindSelect({
            url: rootUrl + "/BaseManage/MaterialGroup/GetSelectJson",
            param: { keyValue: $("#F_ItemGroupID").val() },
            id: "F_Id",
            text: "F_FullName"
        });

        $("#F_WarehouseID").bindSelect({
            url: rootUrl + "/BaseManage/Warehouse/GetSelectJson",
            id: "F_Id",
            text: "F_Name"
        });

        var tableData = [
            { id: 'index', type: 'index', label: '#', width: '40px', align: 'center', placeholder: '', required: '' },
            { id: 'F_UomType', type: 'select', label: '单位类型', width: '80px', align: 'center', placeholder: '', required: '', options: [{ value: 1, label: '基本单位' }, { value: 0, label: '扩展单位' }], disabled: true },
            { id: 'F_UomId', type: 'select', label: '单位', width: '80px', align: 'center', placeholder: '', required: '', options: { url: rootUrl + "/BaseManage/UnitOfMeasure/GetSelectJson", value: 'F_Id', label: 'F_Name', default: { value: '', label: '=选择=' } }, default: '' },
            { id: 'F_RateQty', type: 'number', label: '换算率', width: '80px', align: 'center', placeholder: '', required: '' },
            { id: 'F_PurchasePrice', type: 'number', label: '采购单价', width: '80px', align: 'center', placeholder: '', required: '' },
            { id: 'F_SalesPrice', type: 'number', label: '销售单价', width: '80px', align: 'center', placeholder: '', required: '' },
            { id: 'F_IsPurchaseUOM', type: 'check', label: '是否采购单位', width: '80px', align: 'center', placeholder: '', required: '', default: false },
            { id: 'F_IsSalesUOM', type: 'check', label: '是否销售单位', width: '80px', align: 'center', placeholder: '', required: '', default:false },
            { id: 'F_EnabledMark', type: 'check', label: '有效否', width: '80px', align: 'center', placeholder: '', required: '', default: true },
            //{ id: 'opration', type: 'opration', label: '操作', width: '80px', align: 'center', placeholder: '', required: '' },
        ];

        //表头
        var $trThead = $('<tr class="ui-jqgrid-labels" role="row"></tr>');
        tableData.map(function (item) {
            var $th = $('<th id="gridList_' + item.id + '" role="columnheader" style="width: ' + (item.width ? item.width : 'auto') + ';"><div class="ui-th-div" id="jqgh_gridList_' + item.id + '" style="text-align: ' + item.align + ';">' + item.label + '</div></th>');
            $trThead.append($th);
        })
        $("#gbox_gridList").find("thead").append($trThead);

        //表格内容
        var rowNums = 4;
        for (var i = 1; i <= rowNums; i++) {
            var $trBody = $('<tr role="row" id="tr' + i + '" tabindex="' + i + '" class="jqgrow ui-row-ltr"></tr>');
            tableData.map(function (item) {
                var $td = "";
                if (item.type.toLowerCase() == 'index') {
                    $td = $('<td class="formValue" style="padding:2px;"><div style="text-align:center">' + i + '</div></td>');
                }
                if (item.type.toLowerCase() == 'text' || item.type.toLowerCase() == 'number') {
                    $td = $('<td class="formValue" style="padding:2px;"><input id="' + i + '_' + item.id + '" name="' + i + '_' + item.id + '" type="' + item.type + '" class="form-control ' + (item.type == 'number' ? 'text-right' : 'text-left') + ' ' + item.required + '" placeholder="' + item.placeholder + '" ' + (item.disabled && item.disabled == true ? 'disabled="disabled"' : '') + '/></td>');
                    if (item.default) {
                        $td.find('input').val(item.default);
                    }
                }
                if (item.type.toLowerCase() == 'check') {
                    $td = $('<td class="formValue" style="padding:2px;"><div class="ckbox" style="left:30px;"><input id="' + i + '_' + item.id + '" name="' + i + '_' + item.id + '" type="checkbox" ' + (item.default == true ? 'checked="checked"' : '') + '><label for="' + i + '_' + item.id + '"></label></div></td>');
                }
                if (item.type.toLowerCase() == 'select') {
                    $td = $('<td class="formValue"><select id="' + i + '_' + item.id + '" name="' + i + '_' + item.id + '" class="form-control  ' + item.required + '" ' + (item.disabled && item.disabled == true ? 'disabled="disabled"' : '') + '></select></td>');
                    if (item.options.default) {
                        var $options = $('<option value="' + item.options.default.value + '">' + item.options.default.label + '</option>');
                        $td.find('select').append($options);
                    }
                    if (!item.options.url) {
                        item.options.map(function (_item) {
                            var $options = $('<option value="' + _item.value + '">' + _item.label + '</option>');
                            $td.find('select').append($options);
                        })
                    } else {
                        $td.find('select').bindSelect({
                            url: item.options.url,
                            id: item.options.value,
                            text: item.options.label
                        });
                    }
                    $td.find('select').bindSelect();
                }
                //if (item.type.toLowerCase() == 'opration') {
                //    $td = $('<td class="formValue" style="padding:2px;"><div style="text-align:center"><a id="NF-delete" href="javasript:;" onclick="btn_delete(' + i + ')"><i class="fa fa-trash-o"></i></a></div></td>');
                //}
                $trBody.append($td);
            })
            $("#gbox_gridList").find("tbody").append($trBody);
        }
    }

    function submitForm() {
        if (!$('#form1').formValid()) {
            return false;
        }
        var postData = $("#form1").formSerialize();
        $.submitForm({
            url: rootUrl + "/BaseManage/Material/SubmitForm?keyValue=" + keyValue,
            param: postData,
            success: function () {
                $.currentWindow().$("#gridList").trigger("reloadGrid");
                $.currentWindow().$(".operate").animate({ "left": '-100.1%' }, 200);
            }
        })
    }
</script>

<form id="form1">
    <div style="margin-top: 10px; margin-left: 10px; margin-right: 10px;">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#page1" data-toggle="tab">基本信息</a></li>
            <li class=""><a href="#page2" data-toggle="tab">其它信息</a></li>
            <li class=""><a href="#page3" data-toggle="tab">单位信息</a></li>
            <li class=""><a href="#page4" data-toggle="tab">商品封面</a></li>
            <li class=""><a href="#page5" data-toggle="tab">商品照片</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade in active" id="page1" style="padding-top: 10px;margin-right:10px">
                <table class="form">
                    <tr>
                        <th class="formTitle">商品编码</th>
                        <td class="formValue">
                            <input id="F_EnCode" name="F_EnCode" type="text" class="form-control required" placeholder="请输入商品编码" />
                        </td>
                        <th class="formTitle">商品名称</th>
                        <td class="formValue">
                            <input id="F_FullName" name="F_FullName" type="text" class="form-control required" placeholder="请输入商品名称" />
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">商品简称</th>
                        <td class="formValue">
                            <input id="F_ShortName" name="F_ShortName" type="text" class="form-control" placeholder="请输入商品简称" />
                        </td>
                        <th class="formTitle">商品大类</th>
                        <td class="formValue">
                            <select id="F_ItemGroupID" name="F_ItemGroupID" class="form-control required">
                                <option value="">==请选择==</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">商品小类</th>
                        <td class="formValue">
                            <select id="F_ItemCategoryID" name="F_ItemCategoryID" class="form-control required">
                                <option value="">==请选择==</option>
                            </select>
                        </td>
                        <th class="formTitle">商品条码</th>
                        <td class="formValue">
                            <input id="F_Barcode" name="F_Barcode" type="text" class="form-control" placeholder="请输入商品条码" />
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">有效期（月）</th>
                        <td class="formValue">
                            <input id="F_Period" name="F_Period" type="number" class="form-control" placeholder="请输入有效期" />
                        </td>
                        <th class="formTitle">对应仓库</th>
                        <td class="formValue">
                            <select id="F_WarehouseID" name="F_WarehouseID" class="form-control">
                                <option value="">==请选择==</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">安全库存</th>
                        <td class="formValue">
                            <input id="F_SaveInventory" name="F_SaveInventory" type="number" class="form-control" placeholder="请输入安全库存" />
                        </td>
                        <th class="formTitle" style="height: 35px;">选项</th>
                        <td class="formValue" style="padding-top: 1px;">
                            <div class="ckbox">
                                <input id="F_EnabledMark" name="F_EnabledMark" type="checkbox" checked="checked"><label for="F_EnabledMark">有效</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle" valign="top" style="padding-top: 5px;">
                            备注
                        </th>
                        <td class="formValue" colspan="3">
                            <textarea id="F_Description" name="F_Description" class="form-control" style="height: 60px;"></textarea>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="tab-pane fade in" id="page2" style="padding-top: 10px;margin-right:10px">
                <table class="form">
                    <tr>
                        <th class="formTitle">长度</th>
                        <td class="formValue">
                            <input id="F_Length" name="F_Length" type="number" class="form-control" placeholder="请输入长度" />
                        </td>
                        <th class="formTitle">宽度</th>
                        <td class="formValue">
                            <input id="F_Width" name="F_Width" type="number" class="form-control" placeholder="请输入宽度" />
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">高度</th>
                        <td class="formValue">
                            <input id="F_Height" name="F_Height" type="number" class="form-control" placeholder="请输入高度" />
                        </td>
                        <th class="formTitle">毛重</th>
                        <td class="formValue">
                            <input id="F_CrossWeigth" name="F_CrossWeigth" type="number" class="form-control" placeholder="请输入毛重" />
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle">体积</th>
                        <td class="formValue">
                            <input id="F_Size" name="F_Size" type="number" class="form-control" placeholder="请输入体积" />
                        </td>
                        <th class="formTitle">最后成本</th>
                        <td class="formValue">
                            <input id="F_LastCost" name="F_LastCost" type="number" class="form-control" placeholder="请输入最后成本" />
                        </td>
                    </tr>
                    <tr>
                        <th class="formTitle" style="height: 35px;">选项</th>
                        <td class="formValue" style="padding-top: 1px;" colspan="3">
                            <div class="ckbox">
                                <input id="F_IsBatch" name="F_IsBatch" type="checkbox" checked="checked"><label for="F_IsBatch">批次管理</label>
                            </div>
                            <div class="ckbox">
                                <input id="F_IsForSale" name="F_IsForSale" type="checkbox" checked="checked"><label for="F_IsForSale">可销售否</label>
                            </div>
                            <div class="ckbox">
                                <input id="F_IsZeroValue" name="F_IsZeroValue" type="checkbox" checked="checked"><label for="F_IsZeroValue">库存零价值</label>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="tab-pane fade in gridPanel" id="page3" style="padding-top: 10px;margin-right:10px">
                <div class="ui-jqgrid " id="gbox_gridList" dir="ltr" style="width: 725px;height:330px">
                    <table class="ui-jqgrid-htable ui-common-table table table-bordered form" style="width: 725px;" role="presentation" aria-labelledby="gbox_gridList">
                        <thead>
                        </thead>
                        <tbody>
                            @*<tr role="row" id="1" tabindex="-1" class="jqgrow ui-row-ltr" aria-selected="false" editable="0">
                                    <td class="formValue" style="padding:2px;">
                                        <div style="text-align:center">1</div>
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_UomType" name="1_F_UomType" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_UomId" name="1_F_UomId" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_RateQty" name="1_F_RateQty" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_PurchasePrice" name="1_F_PurchasePrice" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_SalesPrice" name="1_F_SalesPrice" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_IsPurchaseUOM" name="1_F_IsPurchaseUOM" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <input id="1_F_IsSalesUOM" name="1_F_IsSalesUOM" type="text" class="form-control" placeholder="" />
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <div class="ckbox" style="left:30px;">
                                            <input id="1_F_EnabledMark" name="1_F_EnabledMark" type="checkbox" checked="checked"><label for="1_F_EnabledMark"></label>
                                        </div>
                                    </td>
                                    <td class="formValue" style="padding:2px;">
                                        <div style="text-align:center"><a id="NF-delete" href="javasript:;" onclick=""><i class="fa fa-trash-o"></i></a></div>
                                    </td>
                                </tr>*@
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</form>
